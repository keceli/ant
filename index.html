<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ant: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ant
   </div>
   <div id="projectbrief">A2 ant: class-based analysis framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ant Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://travis-ci.org/A2-Collaboration/ant"></a> <a href="https://codecov.io/github/A2-Collaboration/ant?branch=master"></a> <a href="https://scan.coverity.com/projects/a2-collaboration-dev-ant"></a> <a href="https://gitter.im/A2-Collaboration-dev/Lobby"></a></p>
<h1>ant </h1>
<div class="image">
<img src="doc/a2-ant-logo.png?raw=true" alt="A2 ant logo"/>
</div>
<p>Just another **AN**alysis **T**oolkit <code>ant</code>, which can read from many input sources with minimal user intervention and let's you create Physics analyses within minutes.</p>
<p>Please see also the automatically generated <a href="https://a2-collaboration.github.io/ant/">Doxygen pages</a> and the <a href="https://github.com/A2-Collaboration/ant/wiki">Wiki</a>.</p>
<h2>Dependencies</h2>
<ul>
<li>C++11 (gcc &gt;4.9.2 should work, but &gt;6.0 recommended, clang is also supported)</li>
<li>cmake &gt;3.0</li>
<li>libgsl-dev, liblzma-dev (before installing root)</li>
<li><a href="https://root.cern.ch/">CERN ROOT</a> (both ROOT5 and ROOT6 are supported)</li>
<li><a href="https://github.com/A2-Collaboration/pluto6">Pluto</a> (if you use ROOT5, you have to use the <a href="https://github.com/A2-Collaboration/gsi-pluto">pluto5</a> version)</li>
<li><a href="https://github.com/A2-Collaboration/APLCONpp">APLCONpp</a></li>
<li>doxygen (optional)</li>
</ul>
<h2>Installation</h2>
<p><b>Note:</b> <a class="el" href="struct_a.html">A</a> comprehensive installation guide can be found in the <a href="https://github.com/A2-Collaboration/ant/wiki/How-to-Install">Wiki</a>.</p>
<p>Please make sure that you fulfill the dependencies. Install <a href="https://root.cern.ch/building-root">ROOT</a> and Pluto preferably in <code>/opt/root</code> and <code>/opt/pluto</code> to ensure auto-detection by ant's CMake.</p>
<p>Next, you need to get the <a href="https://github.com/A2-Collaboration/APLCONpp">APLCON C++ wrapper</a>. The easiest way is to clone the repository relative to your <code>ant</code> directory at <code>../APLCONpp</code>, then create the build directory at <code>../APLCONpp/build</code>. This way CMake will automatically detect it.</p>
<p>See also the detailed steps described in the corresponding <a href="https://github.com/A2-Collaboration/ant/wiki/How-to-Install#install-aplcon-with-c-wrapper">Wiki section</a>.</p>
<p>Now you should be able to compile the Ant framework. Therefore clone this respository, either directly from <a href="https://github.com/A2-Collaboration/ant.git">https://github.com/A2-Collaboration/ant.git</a> or you may want to fork it. As mentioned above, the installation works best when the APLCONpp and ant folder reside in the same directory. Inside your ant directory create a build direcory:</p>
<p><code>mkdir build &amp;&amp; cd build &amp;&amp; cmake ..</code></p>
<p>Then start the parallel compilation for example on a QuadCore machine with <code>make -j5</code>. You may want to add your <code>ant/build/bin</code> directory to your <code>$PATH</code> variable.</p>
<h2>Parallel Processing</h2>
<p>Ant is designed to run single threaded. This avoids a lot of programming problems and running it on the computation clusters is simpler and more efficient, since you only need to allocate one thread per job. For processing data we recommend to run an Ant process on each input file and then merge the results afterwards using <code>Ant-hadd</code>, <code>Ant-chain</code>, or ROOTs <code>hadd</code> tool (but prefer <code>Ant-hadd --native</code> for custom data type support).</p>
<p>There is also no builtin option to run over multiple input files in one go. This should be handled by external tools like GNU <code>parallel</code>, or <code>AntSubmit</code> on a cluster (see also <code>--no_qsub</code> option), or your shell.</p>
<h2>Quick start guides</h2>
<p>Check the Wiki to learn about the basic usage of <a href="https://github.com/A2-Collaboration/ant/wiki/Running-Ant">Ant</a> itself or how to run Ant tools on <a href="https://github.com/A2-Collaboration/ant/wiki/Blaster">blaster</a> using the provided job submission scripts like the aforementioned <code>AntSubmit</code>. Have a look at the <a href="https://github.com/A2-Collaboration/ant/wiki/Get-your-Physics-started-with-Ant">Getting Started Guide for Physics classes</a> if you have no idea about Ant and how to start writing your own analysis.</p>
<h3>Ant MC tools</h3>
<p>Ant comes with a few tools to generate MC data. It can generate photoproduction processes and decays with <code>Ant-pluto</code>, a frontend utilizing the Pluto event generator for A2 physics (includes the Tagger), shoot particles randomly in all directions using <code>Ant-mcgun</code>, or simulate a complete cocktail of various photoproduction and decay channels according to their cross sections with <code>Ant-cocktail</code>.</p>
<h4>Example: Pluto Decay</h4>
<p>To use Pluto to simulate, for example, the omega &mdash;&gt; pi0 gamma do: </p><div class="fragment"><div class="line">Ant-pluto --reaction &quot;p omega [ pi0 g ]&quot; --Emin 1400 --Emax 1600 --numEvents 10000 -v 2 -o sim.root</div></div><!-- fragment --><p> This will generate 10k events in the incident photon energy range 1400 MeV to 1600 MeV, saving unstable particles. The pi0 will decay into different channels according to the Pluto database. Use the option <code>--no-unstable</code> if you don't want to store intermediate particles and <code>--no-bulk</code> to disable bulk decays using the Pluto database.</p>
<h4>Example: Random Gun</h4>
<p>Shoot 1000 protons into TAPS, 1 proton/Event, 0 to 1 GeV </p><div class="fragment"><div class="line">Ant-mcgun --numEvents 1000 --particle p --theta-max 20 --Emax 1000</div></div><!-- fragment --><h2>Troubleshooting</h2>
<ul>
<li>If you still want to use ROOT5 you should use a not up-to-date compiler. Starting with GCC 9 and Clang 8 ROOT5 won't compile anymore. Use a version prior to those major releases if you need ROOT5, or use ROOT6 otherwise.</li>
<li>In case CMake is not able to locate your Pluto installation, you can provide the environment variable <code>$PLUTOSYS</code> to tell CMake where to find it. If you installed Pluto inside your home directory, <code>~/pluto</code> or <code>~/src/pluto</code>, or placed it in <code>/opt/pluto</code>, the make process may have failed. Please make sure you ran <code>make</code> in your Pluto directory with a proper ROOT installation.</li>
<li>There's a bug in GCC 8.2 which can lead to segfaults if <code>make_shared</code> is called. This is fixed with the release of 8.3, and version prior to 8.2 are not affected as well.</li>
<li>If you're using gcc version 5.x and experiencing build errors within ROOT generated dictionary files (i.e. redeclaration of <code>struct __xfer_bufptrs</code>), please update to a more recent ROOT version. As of November 2015, you need to clone the git branch which includes the patches. To do so:<ul>
<li>get the source with <code>git clone -b v5-34-00-patches <a href="https://github.com/root-mirror/root.git">https://github.com/root-mirror/root.git</a></code></li>
<li><code>cd</code> in the cloned directory</li>
<li>create a new folder for the build process, e.g. <code>mkdir build_dir</code></li>
<li><code>cd</code> in it and run <code>cmake .. &amp;&amp; make -jN</code>, replace <code>N</code> with the number of threads which should be used</li>
<li>set your <code>$ROOTSYS</code> accordingly</li>
</ul>
</li>
<li>gdb version 7.7 crashes in combination with cereal, so use version 7.10</li>
<li>If you are using ROOT6 and run into some issues mainly related to derived classes, please have a look at the <a href="https://github.com/A2-Collaboration/ant/wiki/FAQ#known-problems-with-root6">FAQ in the Wiki</a> and see if you're problem is known already and if there's some way to avoid it.</li>
<li>If using the newest GCC release, like 7.x as of June 2017 or higher in the future (usually ArchLinux users), use the patched ROOTv5 version available <a href="https://github.com/A2-Collaboration/root/commits/v5-34-00-patches-A2">here</a>, which contains patches based on the bug report <a href="https://sft.its.cern.ch/jira/browse/ROOT-8180">ROOT-8180</a>. In the meantime, those patches have been merged upstream.</li>
<li>In case you encounter weird test errors (garbage output of corrupted TFiles <code>TKey::ReadObjWithBuffer msg='Unknown class foDoubly linked listZL</code>), make sure you recompiled Pluto properly with the identical <code>$ROOTSYS</code> as Ant (in particular pay attention to ROOT debug/release builds).</li>
<li>Starting with clang 5.0, there's a problem with compiling the third party tool cereal. The problem is <a href="https://github.com/USCiLab/cereal/issues/439">known and reported</a>. Please use a clang version &lt; 5.0 as long as this issue with RapidJSON isn't fixed.</li>
</ul>
<h1>Contributing</h1>
<p>Please read the following sections if you want to contribute to this project. Always make sure to cover your code with tests, see the <a href="https://github.com/A2-Collaboration/ant/wiki/Tests">wiki</a>. Run <code>make build_and_test</code> before pushing.</p>
<h2>Coding Style</h2>
<ul>
<li>Indentation: 4 spaces, no tabs anywhere</li>
<li>Ant-Codesytle defined in <a href="doc/Ant-Codestyle.xml">doc/Ant-Codestyle.xml</a> (import to QtCreator)</li>
<li><code>#include</code> statements:<ul>
<li>header file for this .cc file first</li>
<li>then grouped by ant, ROOT, STL, others</li>
<li>one line between groups</li>
<li>each group ordered alphabetically</li>
</ul>
</li>
</ul>
<p>Have a look at the <a href="https://github.com/A2-Collaboration/ant/wiki/Coding-Style">Wiki</a> as well.</p>
<h2>Library organization</h2>
<p>The calibration modules specify physics classes, usually below <code>src/analysis/physics/calibration</code>, which produce the histograms used in the GUI part of the module. The analysis classes can access all information organized in <code>expconfig</code>. The <code>slowcontrol</code> libraries are divided to ensure proper initialization order of static registries.</p>
<div class="image">
<img src="doc/library-dependencies.png"/>
</div>
<p>The solid arrows mean "links to", whereas the dashed arrows means "includes only".</p>
<p>Or, automatically generated with </p><div class="fragment"><div class="line">cd build</div><div class="line">cp ../doc/CMakeGraphVizOptions.cmake .</div><div class="line">cmake --graphviz=CmakeGraphViz ..</div><div class="line">dot -Tpng CmakeGraphViz.Ant -o ../doc/library-dependencies-autogenerated.png</div><div class="line">rm CmakeGraphViz*</div></div><!-- fragment --> <div class="image">
<img src="doc/library-dependencies-autogenerated.png"/>
</div>
<h2>Development</h2>
<p>The following items are still to-do:</p>
<ul>
<li>Implement the wire chamber detector (hard)</li>
<li>Implement the conventional tagger ladder including magnetic field energy calibration (easier)</li>
<li>~~Implement Mk1 unpacker (many things already provided)~~ Done including GZ decompression. Scaler buffer decoding still WIP.</li>
<li>~~Implement EPICS reader, and some more slow control variables~~ Done for tagging efficiency at least.</li>
<li>Implement the pair-spectrometer</li>
<li>Add prompt-random subtraction to the tagging efficiency class</li>
</ul>
<h3>Detector Type Mapping to Goat/Acqu</h3>
<table class="doxtable">
<tr>
<th>Ant </th><th>Goat  </th></tr>
<tr>
<td>CB </td><td>NaI </td></tr>
<tr>
<td>PID </td><td>PID </td></tr>
<tr>
<td>MWPC0 </td><td>MWPC </td></tr>
<tr>
<td>MWPC1 </td><td></td></tr>
<tr>
<td>TAPS </td><td>BaF2 </td></tr>
<tr>
<td></td><td>PbWO4 </td></tr>
<tr>
<td>TAPSVeto </td><td>Veto </td></tr>
</table>
<p>All other Ant detectors do not have a representation in Goat/Acqu.</p>
<h3>Data flow</h3>
<p>The physics classes analyse <code>TEvent</code>s provided by different sources or amenders. The main source of events is the AntReader, which itself is either fed by some unpacker or by already unpacked and possibly reconstructed <code>treeEvents</code>. Additionally, the SlowControlManager needs to do proper buffering to make physics classes easy to implement.</p>
<div class="image">
<img src="doc/dataflow.png"/>
</div>
<h2>External Components</h2>
<p>Have a look at those very nice projects, which are used here:</p>
<ul>
<li><a href="https://muflihun.github.io/easyloggingpp/">Easylogging++</a></li>
<li><a href="https://github.com/philsquared/Catch">Catch</a> framework for unit-tests, test-driven development. See <a href="test/">the test/ subdirectory</a>.</li>
<li><a href="http://tclap.sourceforge.net">TCLAP - Templatized C++ Command Line Parser</a></li>
<li><a href="http://uscilab.github.io/cereal/">cereal</a> for <a href="src/tree/TEvent.h">ant::TEvent</a> serialization into ROOT TTree </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
